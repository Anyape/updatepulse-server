jQuery(document).ready(function(e){function s(s){if(l&&(p=p.initialize(e("#wppus_license_data"),WppusAdminLicense.cm_settings),l=!1),e.isPlainObject(s)){if(e("#wppus_license_id").html(s.id),e("#wppus_license_key").val(s.license_key),e("#wppus_license_date_created").val(s.date_created),e("#wppus_license_max_allowed_domains").val(s.max_allowed_domains),e("#wppus_license_owner_name").val(s.owner_name),e("#wppus_license_registered_email").val(s.email),e("#wppus_license_owner_company").val(s.company_name),e("#wppus_license_transaction_id").val(s.txn_id),e("#wppus_license_package_slug").val(s.package_slug),e("#wppus_license_status").val(s.status),e("#wppus_license_data").val(s.data?JSON.stringify(JSON.parse(s.data),null,"\t"):""),e("#wppus_license_package_type").val(s.package_type),p.codemirror.setValue(e("#wppus_license_data").val()),"0000-00-00"!==s.date_expiry&&e("#wppus_license_date_expiry").val(s.date_expiry),"0000-00-00"!==s.date_renewed&&e("#wppus_license_date_renewed").val(s.date_renewed),s.allowed_domains.length>0){var a=e(".wppus-domains-list"),i=a.find("li").clone();i.removeClass("wppus-domain-template"),e.each(s.allowed_domains,function(e,s){var n=i.clone();n.find(".wppus-domain-value").html(s),a.append(n)}),e(".wppus-no-domain").hide(),a.show()}}else e("#wppus_license_key").val(e("#wppus_license_key").data("random_key")),e("#wppus_license_date_created").val((new Date).toISOString().slice(0,10)),e("#wppus_license_max_allowed_domains").val(1),p.codemirror.setValue("{}")}function a(){e("#wppus_license").trigger("reset"),e("wppus_license_values").val(""),e("wppus_license_action").val(""),e(".open-panel").removeAttr("disabled"),e(".wppus-licenses-table .open-panel").show(),e("#wppus_license_id").html(""),e(".wppus-domains-list li:not(.wppus-domain-template)").remove(),e(".wppus-no-domain").show(),e("label.wppus-license-error").hide(),e(".wppus-license-error").removeClass("wppus-license-error"),p.codemirror.setValue("{}")}function i(e,s){e.is(":visible")||e.slideDown(100,function(){s(e),e.find(".inside").animate({opacity:"1"},150)})}function n(e,s){e.is(":visible")&&e.slideUp(100,function(){e.find(".inside").css({opacity:"0"}),s(e)})}var p=wp.codeEditor,l=!0;e("#add_license_trigger").on("click",function(){i(e("#wppus_license_panel"),function(){s(),e("#wppus_license_action").val("create"),e(".wppus-edit-license-label").hide(),e(".wppus-license-show-if-edit").hide(),e(".wppus-add-license-label").show(),e(".open-panel").attr("disabled","disabled"),e(".wppus-licenses-table .open-panel").hide(),e("html, body").animate({scrollTop:e("#wppus_license_panel").offset().top-e("#wpadminbar").height()-20},500)})}),e(".wppus-licenses-table .open-panel .edit a").on("click",function(a){a.preventDefault();var n=JSON.parse(e(this).closest("tr").find('input[name="license_data[]"]').val());i(e("#wppus_license_panel"),function(){s(n),e("#wppus_license_action").val("update"),e(".wppus-edit-license-label").show(),e(".wppus-license-show-if-edit").show(),e(".wppus-add-license-label").hide(),e(".open-panel").attr("disabled","disabled"),e(".wppus-licenses-table .open-panel").hide(),e("html, body").animate({scrollTop:e("#wppus_license_panel").offset().top-e("#wpadminbar").height()-20},500)})}),e("#wppus_license_cancel, .close-panel.reset").on("click",function(){e("html, body").animate({scrollTop:e(".wppus-wrap").offset().top-e("#wpadminbar").height()-20},150),n(e("#wppus_license_panel"),function(){a()})}),e.validator&&(e.validator.methods.licenseDate=function(e,s){return this.optional(s)||/[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/.test(e)},e.validator.methods.slug=function(e,s){return this.optional(s)||/[a-z0-9-]*/.test(e)},e("#wppus_license").validate({ignore:".CodeMirror *",errorClass:"wppus-license-error",rules:{wppus_license_key:{required:!0},wppus_license_package_slug:{required:!0,slug:!0},wppus_license_registered_email:{required:!0,email:!0},wppus_license_date_created:{required:!0,licenseDate:!0},wppus_license_date_expiry:{licenseDate:!0},wppus_license_date_renewed:{licenseDate:!0},wppus_license_max_allowed_domains:{required:!0}},submitHandler:function(s){var a=e(".wppus-domains-list li:not(.wppus-domain-template) .wppus-domain-value"),i={id:e("#wppus_license_id").html(),license_key:e("#wppus_license_key").val(),max_allowed_domains:e("#wppus_license_max_allowed_domains").val(),allowed_domains:a.map(function(){return e(this).text()}).get(),status:e("#wppus_license_status").val(),owner_name:e("#wppus_license_owner_name").val(),email:e("#wppus_license_registered_email").val(),company_name:e("#wppus_license_owner_company").val(),txn_id:e("#wppus_license_transaction_id").val(),data:e("#wppus_license_data").val(),date_created:e("#wppus_license_date_created").val(),date_renewed:e("#wppus_license_date_renewed").val(),date_expiry:e("#wppus_license_date_expiry").val(),package_slug:e("#wppus_license_package_slug").val(),package_type:e("#wppus_license_package_type").val()};e("#wppus_license_values").val(JSON.stringify(i)),e(".no-submit").removeAttr("name"),s.submit()}})),e("#wppus_license_registered_domains").on("click",".wppus-remove-domain",function(s){s.preventDefault(),e(this).parent().remove(),1>=e(".wppus-remove-domain").length&&e(".wppus-no-domain").show()})});