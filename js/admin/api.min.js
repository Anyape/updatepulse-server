jQuery(document).ready(function(e){function t(e){var t=new Uint8Array(e),n="";window.crypto.getRandomValues(t);for(var c=0;c<t.length;c++)n+=t[c].toString(e).padStart(2,"0");return n}e(".webhook-multiple").each(function(t,n){function c(){var e=o.get(0).value.trim(),t=""!==e&&!Object.values(p).some(function(t){return t===e}),c=/^(https?:\/\/)?([\w-]+(\.[\w-]+)+\/?)|localhost(:\d+)?(\/[\w-]+)*\/?(\?\S*)?$/;t=t&&c.test(e)&&16<=a.val().length&&0!==n.find('.event-container input[type="checkbox"]:checked').length,r.disabled=!t}function i(){h.innerHTML="",Object.keys(p).forEach(function(e){var t=document.createElement("div"),n=document.createElement("span"),c=document.createElement("span"),o=document.createElement("span"),a=document.createElement("button");t.className="item",n.textContent=e,n.title=e,n.classList="url",c.textContent=p[e].secret,c.classList="secret",o.textContent=1===p[e].events.length?Wppus_l10n.eventApiCountSingular:Wppus_l10n.eventApiCountPlural.replace("%d",p[e].events.length),o.title="("+p[e].events.join(", ")+")",o.classList="summary",a.type="button",a.innerHTML='<span class="wppus-remove-icon" aria-hidden="true"></span>',a.onclick=function(){confirm(Wppus_l10n.deleteApiWebhookConfirm)&&(delete p[e],i())},t.appendChild(o),t.appendChild(n),t.appendChild(c),t.appendChild(a),h.appendChild(t)}),0===Object.keys(p).length?h.classList.add("empty"):h.classList.remove("empty")}n=e(n);var p=JSON.parse(n.find(".webhook-values").val()),o=n.find(".new-webhook-item-url"),a=n.find(".new-webhook-item-secret"),d=n.find('input[data-webhook-event="all"]'),l=n.find('input[data-webhook-event="package"]'),s=n.find('input[data-webhook-event="license"]'),r=n.find(".webhook-add").get(0),h=n.find(".webhook-items").get(0);0===p.length&&(p={}),r.onclick=function(){r.disabled="disabled",p[o.val()]={secret:a.val(),events:[]},l.prop("checked")&&l.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),s.prop("checked")&&s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),l.closest(".event-container").find('.child input[type="checkbox"]').length===l.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(l.prop("checked",!0),l.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),s.closest(".event-container").find('.child input[type="checkbox"]').length===s.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(s.prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),n.find('.event-types input[type="checkbox"]').each(function(t,n){n=e(n),"all"!==n.data("webhook-event")&&n.prop("checked")&&p[o.val()].events.push(n.data("webhook-event"))}),o.val(""),a.val(""),d.prop("checked",!0),d.trigger("change"),i()},o.on("input",c),a.on("input",c),n.find('.event-types input[type="checkbox"]').on("change",function(){d.prop("checked")?(n.find('.event-types input[type="checkbox"]').prop("checked",!0),n.find('.event-types input[type="checkbox"]').prop("disabled",!0),d.prop("disabled",!1)):(n.find('.event-types input[type="checkbox"]').prop("disabled",!1),l.prop("checked")&&(l.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),l.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0)),s.prop("checked")&&(s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0))),c()}),d.prop("checked",!0),d.trigger("change"),i(),e('input[type="submit"]').on("click",function(t){t.preventDefault(),n.find(".webhook-values").val(JSON.stringify(p)),e(this).closest("form").submit()})}),e(".api-keys-multiple").each(function(n,c){function i(){var e=a.get(0).value.trim(),t=""!==e&&!Object.values(o).some(function(t){return t===e});t=t&&/^[a-zA-Z0-9_-]+$/.test(e)&&0!==c.find('.event-container:not(.other) input[type="checkbox"]:checked').length,l.disabled=!t}function p(){s.innerHTML="",Object.keys(o).forEach(function(e){var t=document.createElement("div"),n=document.createElement("span"),c=document.createElement("span"),i=document.createElement("span"),a=document.createElement("button");t.className="item",n.textContent=e,n.classList="id",c.textContent=o[e].key,c.classList="key",i.textContent=1===o[e].access.length?Wppus_l10n.eventApiCountSingular:Wppus_l10n.eventApiCountPlural.replace("%d",o[e].access.length),i.title="("+o[e].access.join(", ")+")",i.classList="summary",a.type="button",a.innerHTML='<span class="wppus-remove-icon" aria-hidden="true"></span>',a.onclick=function(){confirm(Wppus_l10n.deleteApiKeyConfirm)&&(delete o[e],p())},t.appendChild(i),t.appendChild(n),t.appendChild(c),t.appendChild(a),s.appendChild(t)}),0===Object.keys(o).length?s.classList.add("empty"):s.classList.remove("empty")}c=e(c);var o=JSON.parse(c.find(".api-key-values").val()),a=c.find(".new-api-key-item-id"),d=c.find('input[data-api-action="all"]'),l=c.find(".api-keys-add").get(0),s=c.find(".api-keys-items").get(0);0===o.length&&(o={}),l.onclick=function(){l.disabled="disabled",o[a.val()]={key:t(16),access:[]},(d.prop("checked")||c.find('.event-container:not(.all, .other) input[type="checkbox"]').length===c.find('.event-container:not(.all, .other) input[type="checkbox"]:checked').length)&&(d.prop("checked",!0),c.find('.event-container:not(.all) input[type="checkbox"]').prop("checked",!1),o[a.val()].access.push("all")),c.find('.event-container input[type="checkbox"]').each(function(t,n){n=e(n),"all"!==n.data("api-action")&&n.prop("checked")&&o[a.val()].access.push(n.data("api-action"))}),d.prop("checked",!0),d.trigger("change"),a.val(""),i(),p()},a.on("input",i),c.find('.event-types input[type="checkbox"]').on("change",function(){d.prop("checked")?(c.find('.event-container:not(.other) input[type="checkbox"]').prop("checked",!0),c.find('.event-container:not(.other) input[type="checkbox"]').prop("disabled",!0),d.prop("disabled",!1)):c.find('.event-types input[type="checkbox"]').prop("disabled",!1),i()}),d.prop("checked",!0),d.trigger("change"),p(),e('input[type="submit"]').on("click",function(t){t.preventDefault(),c.find(".api-key-values").val(JSON.stringify(o)),e(this).closest("form").submit()})})});