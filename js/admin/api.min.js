jQuery(document).ready(function(e){function n(e){var n=new Uint8Array(e),t="";window.crypto.getRandomValues(n);for(var i=0;i<n.length;i++)t+=n[i].toString(e).padStart(2,"0");return t}e(".webhook-multiple").each(function(n,t){function i(){var e=a.get(0).value.trim(),n=""!==e&&!Object.values(p).some(function(n){return n===e}),i=/^(https?:\/\/)?([\w-]+(\.[\w-]+)+\/?)|localhost(:\d+)?(\/[\w-]+)*\/?(\?\S*)?$/;n=n&&i.test(e)&&16<=o.val().length&&0!==t.find('.event-container input[type="checkbox"]:checked').length,r.disabled=!n}function c(){h.innerHTML="",Object.keys(p).forEach(function(e){var n=document.createElement("div"),t=document.createElement("span"),i=document.createElement("span"),a=document.createElement("span"),o=document.createElement("button"),l="",d=p[e].events;if(2===d.length&&d.includes("package")&&d.includes("license"))l=WppusAdminMain_l10n.eventApiCountAll;else{var s={package:"",license:""};["package","license"].forEach(function(e,n){var t="package"===e?WppusAdminMain_l10n.eventApiTypePackage:WppusAdminMain_l10n.eventApiTypeLicense;d.includes(e)?s[e]=WppusAdminMain_l10n.eventApiCountAllType.replace("%s",t):1===d.filter(function(n){return n.startsWith(e)}).length?s[e]=WppusAdminMain_l10n.eventApiCountTypeSingular.replace("%s",t):d.filter(function(n){return n.startsWith(e)}).length&&(s[e]=WppusAdminMain_l10n.eventApiCountTypePlural.replace("%1$d",d.filter(function(n){return n.startsWith(e)}).length).replace("%2$s",t))}),l=""!==s.package&&""!==s.license?s.package+WppusAdminMain_l10n.apiSumSep+"<br>"+s.license:""!==s.package?s.package:s.license}n.className="item",t.textContent=e,t.title=e,t.classList="url",i.textContent=p[e].secret,i.classList="secret",a.innerHTML=l,a.title="("+p[e].events.join(", ")+")",a.classList="summary",o.type="button",o.innerHTML='<span class="wppus-remove-icon" aria-hidden="true"></span>',o.onclick=function(){confirm(WppusAdminMain_l10n.deleteApiWebhookConfirm)&&(delete p[e],c())},n.appendChild(a),n.appendChild(t),n.appendChild(i),n.appendChild(o),h.appendChild(n)}),0===Object.keys(p).length?h.classList.add("empty"):h.classList.remove("empty")}t=e(t);var p=JSON.parse(t.find(".webhook-values").val()),a=t.find(".new-webhook-item-url"),o=t.find(".new-webhook-item-secret"),l=t.find('input[data-webhook-event="all"]'),d=t.find('input[data-webhook-event="package"]'),s=t.find('input[data-webhook-event="license"]'),r=t.find(".webhook-add").get(0),h=t.find(".webhook-items").get(0);0===p.length&&(p={}),r.onclick=function(){r.disabled="disabled",p[a.val()]={secret:o.val(),events:[]},d.prop("checked")&&d.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),s.prop("checked")&&s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),d.closest(".event-container").find('.child input[type="checkbox"]').length===d.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(d.prop("checked",!0),d.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),s.closest(".event-container").find('.child input[type="checkbox"]').length===s.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(s.prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),t.find('.event-types input[type="checkbox"]').each(function(n,t){t=e(t),"all"!==t.data("webhook-event")&&t.prop("checked")&&p[a.val()].events.push(t.data("webhook-event"))}),a.val(""),o.val(""),l.prop("checked",!0),l.trigger("change"),c()},a.on("input",i),o.on("input",i),t.find('.event-types input[type="checkbox"]').on("change",function(){l.prop("checked")?(t.find('.event-types input[type="checkbox"]').prop("checked",!0),t.find('.event-types input[type="checkbox"]').prop("disabled",!0),l.prop("disabled",!1)):(t.find('.event-types input[type="checkbox"]').prop("disabled",!1),d.prop("checked")&&(d.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),d.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0)),s.prop("checked")&&(s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0))),i()}),l.prop("checked",!0),l.trigger("change"),c(),e('input[type="submit"]').on("click",function(n){n.preventDefault(),t.find(".webhook-values").val(JSON.stringify(p)),e(this).closest("form").submit()})}),e(".api-keys-multiple").each(function(t,i){function c(){var e=o.get(0).value.trim(),n=""!==e&&!Object.values(a).some(function(n){return n===e});n=n&&/^[a-zA-Z0-9_-]+$/.test(e)&&0!==i.find('.event-container:not(.other) input[type="checkbox"]:checked').length,d.disabled=!n}function p(){s.innerHTML="",Object.keys(a).forEach(function(e){var n=document.createElement("div"),t=document.createElement("span"),i=document.createElement("span"),c=document.createElement("span"),o=document.createElement("button"),l="",d=a[e].access;l=1===d.length&&"all"===d[0]?WppusAdminMain_l10n.actionApiCountAll:2===d.length&&d.includes("all")&&d.includes("other")?WppusAdminMain_l10n.actionApiCountAllOther:2===d.length&&d.includes("other")?WppusAdminMain_l10n.actionApiCountSingularOther:d.includes("other")?WppusAdminMain_l10n.actionApiCountPluralOther.replace("%d",d.length-1):1===d.length?WppusAdminMain_l10n.actionApiCountSingular:WppusAdminMain_l10n.actionApiCountPlural.replace("%d",d.length),n.className="item",t.textContent=e,t.classList="id",i.textContent=a[e].key,i.classList="key",c.textContent=l,c.title="("+a[e].access.join(", ")+")",c.classList="summary",o.type="button",o.innerHTML='<span class="wppus-remove-icon" aria-hidden="true"></span>',o.onclick=function(){confirm(WppusAdminMain_l10n.deleteApiKeyConfirm)&&(delete a[e],p())},n.appendChild(c),n.appendChild(t),n.appendChild(i),n.appendChild(o),s.appendChild(n)}),0===Object.keys(a).length?s.classList.add("empty"):s.classList.remove("empty")}i=e(i);var a=JSON.parse(i.find(".api-key-values").val()),o=i.find(".new-api-key-item-id"),l=i.find('input[data-api-action="all"]'),d=i.find(".api-keys-add").get(0),s=i.find(".api-keys-items").get(0);0===a.length&&(a={}),d.onclick=function(){d.disabled="disabled",a[o.val()]={key:n(16),access:[]},(l.prop("checked")||i.find('.event-container:not(.all, .other) input[type="checkbox"]').length===i.find('.event-container:not(.all, .other) input[type="checkbox"]:checked').length)&&(l.prop("checked",!0),i.find('.event-container:not(.all, .other) input[type="checkbox"]').prop("checked",!1),a[o.val()].access.push("all")),i.find('.event-container input[type="checkbox"]').each(function(n,t){t=e(t),"all"!==t.data("api-action")&&t.prop("checked")&&a[o.val()].access.push(t.data("api-action"))}),i.find('.event-container.other input[type="checkbox"]').prop("checked",!1),l.prop("checked",!0),l.trigger("change"),o.val(""),c(),p()},o.on("input",c),i.find('.event-types input[type="checkbox"]').on("change",function(){l.prop("checked")?(i.find('.event-container:not(.other) input[type="checkbox"]').prop("checked",!0),i.find('.event-container:not(.other) input[type="checkbox"]').prop("disabled",!0),l.prop("disabled",!1)):i.find('.event-types input[type="checkbox"]').prop("disabled",!1),c()}),l.prop("checked",!0),l.trigger("change"),p(),e('input[type="submit"]').on("click",function(n){n.preventDefault(),i.find(".api-key-values").val(JSON.stringify(a)),e(this).closest("form").submit()})})});