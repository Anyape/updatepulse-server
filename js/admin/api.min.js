jQuery(document).ready(function(e){function n(e){var n=new Uint8Array(e),t="";window.crypto.getRandomValues(n);for(var i=0;i<n.length;i++)t+=n[i].toString(e).padStart(2,"0");return t}e(".webhook-multiple").each(function(t,i){function c(){var e=l.get(0).value.trim(),n=""!==e&&!Object.values(o).some(function(n){return n===e}),t=/^(https?:\/\/)?([\w-]+(\.[\w-]+)+\/?)|localhost(:\d+)?(\/[\w-]+)*\/?(\?\S*)?$/,c=/^UPDATEPULSE_L_[a-zA-Z0-9_-]+$/;n=n&&t.test(e)&&16<=d.val().length&&0!==i.find('.event-container input[type="checkbox"]:checked').length&&(0===p.val().length||c.test(p.val())),u.disabled=!n}function a(){v.innerHTML="",Object.keys(o).forEach(function(e){var n=document.createElement("div"),t=document.createElement("span"),i=document.createElement("span"),c=document.createElement("span"),l=document.createElement("button"),p="",d=o[e].events;if(2===d.length&&d.includes("package")&&d.includes("license"))p=UPServAdminMain_l10n.eventApiCountAll;else{var r={package:"",license:""};["package","license"].forEach(function(e,n){var t="package"===e?UPServAdminMain_l10n.eventApiTypePackage:UPServAdminMain_l10n.eventApiTypeLicense;d.includes(e)?r[e]=UPServAdminMain_l10n.eventApiCountAllType.replace("%s",t):1===d.filter(function(n){return n.startsWith(e)}).length?r[e]=UPServAdminMain_l10n.eventApiCountTypeSingular.replace("%s",t):d.filter(function(n){return n.startsWith(e)}).length&&(r[e]=UPServAdminMain_l10n.eventApiCountTypePlural.replace("%1$d",d.filter(function(n){return n.startsWith(e)}).length).replace("%2$s",t))}),p=""!==r.package&&""!==r.license?r.package+UPServAdminMain_l10n.apiSumSep+"<br>"+r.license:""!==r.package?r.package:r.license}n.className="item",t.textContent=o[e].url,t.title=o[e].url,t.classList="url",i.textContent=o[e].secret,i.classList="secret",c.innerHTML=p,c.title="("+o[e].events.join(", ")+")",c.classList="summary",l.type="button",l.innerHTML='<span class="upserv-remove-icon" aria-hidden="true"></span>',l.onclick=function(){confirm(UPServAdminMain_l10n.deleteApiWebhookConfirm)&&(delete o[e],a())},o[e].licenseAPIKey&&(t.title+="\n("+o[e].licenseAPIKey+")"),n.appendChild(c),n.appendChild(t),n.appendChild(i),n.appendChild(l),v.appendChild(n)}),0===Object.keys(o).length?v.classList.add("empty"):v.classList.remove("empty")}i=e(i);var o=JSON.parse(i.find(".webhook-values").val()),l=i.find(".new-webhook-item-url"),p=i.find(".new-webhook-item-license_api_key"),d=i.find(".new-webhook-item-secret"),r=i.find('input[data-webhook-event="all"]'),s=i.find('input[data-webhook-event="package"]'),h=i.find('input[data-webhook-event="license"]'),u=i.find(".webhook-add").get(0),v=i.find(".webhook-items").get(0);0===o.length&&(o={}),u.onclick=function(){if(u.disabled="disabled",i.find('.event-container.license input[type="checkbox"]:checked').length&&!p.val().length&&!confirm(UPServAdminMain_l10n.addWebhookNoLicenseApiConfirm))return u.disabled=!1,void a();var t=btoa(l.val().trim()).replace(/\//g,"|");o[t]={url:l.val(),secret:d.val(),licenseAPIKey:"UPDATEPULSE_L_"+p.val().replace(/^UPDATEPULSE_L_/,""),events:[]},s.prop("checked")&&s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),h.prop("checked")&&h.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1),s.closest(".event-container").find('.child input[type="checkbox"]').length===s.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(s.prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),h.closest(".event-container").find('.child input[type="checkbox"]').length===h.closest(".event-container").find('.child input[type="checkbox"]:checked').length&&(h.prop("checked",!0),h.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!1)),i.find('.event-types input[type="checkbox"]').each(function(n,i){i=e(i),"all"!==i.data("webhook-event")&&i.prop("checked")&&o[t].events.push(i.data("webhook-event"))}),l.val(""),d.val(n(8)),p.val(""),r.prop("checked",!0),r.trigger("change"),a()},l.on("input",c),d.on("input",c),p.on("input",c),i.find('.event-types input[type="checkbox"]').on("change",function(){r.prop("checked")?(i.find('.event-types input[type="checkbox"]').prop("checked",!0),i.find('.event-types input[type="checkbox"]').prop("disabled",!0),r.prop("disabled",!1)):(i.find('.event-types input[type="checkbox"]').prop("disabled",!1),s.prop("checked")&&(s.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),s.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0)),h.prop("checked")&&(h.closest(".event-container").find('.child input[type="checkbox"]').prop("checked",!0),h.closest(".event-container").find('.child input[type="checkbox"]').prop("disabled",!0))),i.find('.event-container.license input[type="checkbox"]:checked').length?i.find(".show-if-license").removeClass("hidden"):i.find(".show-if-license").addClass("hidden"),c()}),r.prop("checked",!0),r.trigger("change"),a(),e('input[type="submit"]').on("click",function(n){n.preventDefault(),i.find(".webhook-values").val(JSON.stringify(o)),e(this).closest("form").submit()})}),e(".api-keys-multiple").each(function(t,i){function c(){var e=l.get(0).value.trim(),n=""!==e&&!Object.values(o).some(function(n){return n===e});n=n&&/^[a-zA-Z0-9_-]+$/.test(e)&&0!==i.find('.event-container:not(.other) input[type="checkbox"]:checked').length,d.disabled=!n}function a(){r.innerHTML="",Object.keys(o).forEach(function(e){var n=document.createElement("div"),t=document.createElement("span"),i=document.createElement("span"),c=document.createElement("span"),l=document.createElement("button"),p="",d=o[e].access;p=1===d.length&&"all"===d[0]?UPServAdminMain_l10n.actionApiCountAll:2===d.length&&d.includes("all")&&d.includes("other")?UPServAdminMain_l10n.actionApiCountAllOther:2===d.length&&d.includes("other")?UPServAdminMain_l10n.actionApiCountSingularOther:d.includes("other")?UPServAdminMain_l10n.actionApiCountPluralOther.replace("%d",d.length-1):1===d.length?UPServAdminMain_l10n.actionApiCountSingular:UPServAdminMain_l10n.actionApiCountPlural.replace("%d",d.length),n.className="item",t.textContent=e,t.classList="id",i.textContent=o[e].key,i.classList="key",c.textContent=p,c.title="("+o[e].access.join(", ")+")",c.classList="summary",l.type="button",l.innerHTML='<span class="upserv-remove-icon" aria-hidden="true"></span>',l.onclick=function(){confirm(UPServAdminMain_l10n.deleteApiKeyConfirm)&&(delete o[e],a())},n.appendChild(c),n.appendChild(t),n.appendChild(i),n.appendChild(l),r.appendChild(n)}),0===Object.keys(o).length?r.classList.add("empty"):r.classList.remove("empty")}i=e(i);var o=JSON.parse(i.find(".api-key-values").val()),l=i.find(".new-api-key-item-id"),p=i.find('input[data-api-action="all"]'),d=i.find(".api-keys-add").get(0),r=i.find(".api-keys-items").get(0),s=i.data("prefix");0===o.length&&(o={}),d.onclick=function(){var t=s+l.val().replace(new RegExp("^"+s),"");d.disabled="disabled",o[t]={key:n(16),access:[]},(p.prop("checked")||i.find('.event-container:not(.all, .other) input[type="checkbox"]').length===i.find('.event-container:not(.all, .other) input[type="checkbox"]:checked').length)&&(p.prop("checked",!0),i.find('.event-container:not(.all, .other) input[type="checkbox"]').prop("checked",!1),o[t].access.push("all")),i.find('.event-container input[type="checkbox"]').each(function(n,i){i=e(i),"all"!==i.data("api-action")&&i.prop("checked")&&(console.log(n),console.log(o),o[t].access.push(i.data("api-action")))}),i.find('.event-container.other input[type="checkbox"]').prop("checked",!1),p.prop("checked",!0),p.trigger("change"),l.val(""),c(),a()},l.on("input",c),i.find('.event-types input[type="checkbox"]').on("change",function(){p.prop("checked")?(i.find('.event-container:not(.other) input[type="checkbox"]').prop("checked",!0),i.find('.event-container:not(.other) input[type="checkbox"]').prop("disabled",!0),p.prop("disabled",!1)):i.find('.event-types input[type="checkbox"]').prop("disabled",!1),c()}),p.prop("checked",!0),p.trigger("change"),a(),e('input[type="submit"]').on("click",function(n){n.preventDefault(),i.find(".api-key-values").val(JSON.stringify(o)),e(this).closest("form").submit()})})});