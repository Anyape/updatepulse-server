jQuery(document).ready(function(e){var a=!1;e(".upserv-wrap .wp-list-table .delete a").on("click",function(a){window.confirm(UPServAdminPackage_l10n.deletePackageConfirm)&&a.preventDefault(),e(this).attr("href",e(this).data("href"))}),e(".upserv-delete-all-packages").on("click",function(e){window.confirm(UPServAdminPackage_l10n.deletePackagesConfirm)||e.preventDefault()}),e("#upserv_modal_package_details").on("open",function(a,i){var r=i.data("info"),n=e(this);n.find("h2").text(r.name+" v"+r.version),n.find("pre").text(JSON.stringify(r,null,2))}),e("#upserv_register_package_slug").on("input",function(){0<e(this).val().length&&!a&&0<e("#upserv_vcs_select").val().length?e("#upserv_register_package_trigger").removeAttr("disabled"):a||e("#upserv_register_package_trigger").attr("disabled","disabled")}),e("#upserv_vcs_select").on("change",function(){0<e(this).val().length&&!a&&0<e("#upserv_register_package_slug").val().length?e("#upserv_register_package_trigger").removeAttr("disabled"):a||e("#upserv_register_package_trigger").attr("disabled","disabled")}),e("#upserv_register_package_trigger").on("click",function(i){i.preventDefault();var r=e(this),n={slug:e("#upserv_register_package_slug").val(),vcs_key:e("#upserv_vcs_select").val(),nonce:e("#upserv_plugin_options_handler_nonce").val(),action:"upserv_register_package_from_vcs"};r.attr("disabled","disabled"),r.next().css("visibility","visible"),a=!0,e.ajax({url:UPServAdminPackage.ajax_url,data:n,type:"POST",success:function(i){if(i.success)window.location.reload(!0);else{var n="";e.each(i.data,function(e,a){n+=a.message+"\n"}),a=!1,r.removeAttr("disabled"),r.next().css("visibility","hidden"),window.alert(n)}},error:function(e,i){UPServAdminPackage.debug&&console.log(i),a=!1,r.removeAttr("disabled"),r.next().css("visibility","hidden")}})}),e("#upserv_manual_package_upload").on("change",function(){var a=e(this);0<a.prop("files").length?(e("#upserv_manual_package_upload_filename").val(a.prop("files")[0].name),e("#upserv_manual_package_upload_trigger").removeAttr("disabled")):(e("#upserv_manual_package_upload_filename").val(""),e("#upserv_manual_package_upload_trigger").attr("disabled","disabled"))}),e("#upserv_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(a){var i=e("#upserv_manual_package_upload");i.prop("files",a.originalEvent.dataTransfer.files),i.trigger("change")}),e(".manual-package-upload-trigger").on("click",function(a){a.preventDefault();var i=e(this),r=new FormData,n=!0,t=e("#upserv_manual_package_upload").prop("files")[0],l=/^([a-zA-Z0-9\-\_]*)\.zip$/gm,s=["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"];i.attr("disabled","disabled"),i.next().css("visibility","visible"),void 0!==t&&void 0!==t.type&&void 0!==t.size&&void 0!==t.name?(-1===e.inArray(t.type,s)&&(window.alert(UPServAdminPackage_l10n.invalidFileFormat),n=!1),0===t.size&&(window.alert(UPServAdminPackage_l10n.invalidFileSize),n=!1),l.test(t.name)||(window.alert(UPServAdminPackage_l10n.invalidFileName),n=!1)):(window.alert(UPServAdminPackage_l10n.invalidFile),n=!1),n?(r.append("action","upserv_manual_package_upload"),r.append("package",t),r.append("nonce",e("#upserv_plugin_options_handler_nonce").val()),e.ajax({url:UPServAdminPackage.ajax_url,data:r,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(a){if(a.success)window.location.reload(!0);else{var r="";e.each(a.data,function(e,a){r+=a.message+"\n"}),i.removeAttr("disabled"),window.alert(r)}},error:function(e,a){UPServAdminPackage.debug&&console.log(a)}})):(i.next().css("visibility","hidden"),i.removeAttr("disabled"))})});