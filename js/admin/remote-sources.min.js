jQuery(document).ready(function(e){if(e("#upserv_vcs").length){var t=e(".form-container.package-source"),n=t.find('input[type="checkbox"][data-prop], input[type="text"][data-prop], input[type="number"][data-prop], input[type="password"][data-prop], input[type="hidden"][data-prop], select[data-prop]'),i=t.find('input[type="text"][data-prop], input[type="number"][data-prop], input[type="password"][data-prop]'),s=JSON.parse(e("#upserv_vcs").val()),d=function(){e.each(s,function(t){e("#"+t).length>0||o(t)}),Object.keys(s).length>0&&e(".vcs .item:not(.template)").first().trigger("click")},a=function(i){var s=e("#"+i);0!==s.length&&(e(".vcs .item").removeClass("selected"),s.addClass("selected"),v(!1),t.removeClass("hidden"),p(i),n.trigger("change"))},r=function(t,i){t&&(s[t]={},e.each(n,function(){var n=e(this),i=n.data("prop");n.is('input[type="checkbox"]')?s[t][i]=0:n.is("select")?s[t][i]=n.find('option[value="daily"]').length>0?"daily":n.find("option").first().val():n.is('input[type="number"]')?s[t][i]=0:s[t][i]=""}),e.each(i,function(e,n){s[t][e]=n}))},o=function(t){var n=e(".vcs .item.template").clone(),i=s[t],d=i.url.split("/").filter(function(e){return e.length>0}).pop();n.removeClass("template upserv-modal-open-handle"),n.data("modal_id",null),n.removeAttr("data-modal_id"),n.find(".placeholder").remove(),n.find(".identifier").text(d),n.find(".branch").text(i.branch),n.find(".hidden").removeClass("hidden"),n.attr("id",t),n.find(".service span").addClass("hidden"),n.insertBefore(e(".vcs .item.template")),f(t)},c=function(n){delete s[n],e("#"+n).remove(),p(),v(!0),t.addClass("hidden")},p=function(t){n.each(function(){var n=e(this),i=n.data("prop");if(i){var d=t&&s[t]&&void 0!==s[t][i]?s[t][i]:null;n.is('input[type="checkbox"]')?n.prop("checked",["1","true","yes","on",1,!0].includes(d)):n.is('input[type="number"]')?n.val(d?parseInt(d):0):n.val(d||""),e("#upserv_vcs_list").val(t)}})},l=function(t){var n=e(".vcs .item.selected").attr("id"),i=t.data("prop");if(n&&i){var d=null;d=t.is('input[type="checkbox"]')?t.prop("checked")?"1":"0":t.val(),s[n]&&(s[n][i]=d);var a=s[n].url.split("/").filter(function(e){return e.length>0}).pop();e("#"+n).find(".branch").text(s[n].branch),e("#"+n).find(".identifier").text(a),h(t),f(n),u()}},u=function(){e("#upserv_vcs").val(JSON.stringify(s))},v=function(e){n.prop("disabled",e)},h=function(t){if(0!==t.closest(".self-hosted").length){var n=e(".vcs .item.selected").attr("id"),i=t.prop("checked");e(".self-hosted").prop("checked",!1),t.prop("checked",i),s[n].type=i?t.val():"undefined"}},f=function(n){var i=s[n].url.match(/https?:\/\/([^\/]+)\//),d=e("#"+n);d.find(".service span").addClass("hidden"),t.find(".self-hosted").addClass("hidden"),i&&"github.com"===i[1]?(s[n].type="github",s[n].self_hosted=!1,d.find(".service .github").removeClass("hidden")):i&&"gitlab.com"===i[1]?(s[n].type="gitlab",s[n].self_hosted=!1,d.find(".service .gitlab").removeClass("hidden")):i&&"bitbucket.org"===i[1]?(s[n].type="bitbucket",s[n].self_hosted=!1,d.find(".service .bitbucket").removeClass("hidden")):(s[n].type=s[n].type?s[n].type:"undefined",s[n].self_hosted=!0,d.find(".service .self-hosted-"+s[n].type).removeClass("hidden"),t.find(".self-hosted").removeClass("hidden"))};n.on("change",function(t){t.stopPropagation(),l(e(this))}),i.on("keyup",function(t){t.stopPropagation(),l(e(this))}),e(document).on("upserv-modal-close",function(t,n){e(".upserv-wrap").find(".form-container.package-source").length>0&&v(!1)}),e(".vcs").on("click",".item",function(t){var n=e(this);n.hasClass("upserv-modal-open-handle")?(v(!0),e(".upserv-modal .error").addClass("hidden")):a(n.attr("id"))}),e("#upserv_add_vcs").on("click",function(t){t.preventDefault(),e(".upserv-modal .error").addClass("hidden"),e(".vcs .item.selected").removeClass("selected");var n=e("#upserv_add_vcs_url").val(),i=e("#upserv_add_vcs_branch").val();if(n&&n.match(/^https?:\/\/[^\/]+\/[^\/]+\/$/))if(i&&isNaN(i)){var d=Math.random().toString(36).substring(7);r(d,{url:n,branch:i}),o(d,s[d]),a(d),e(this).closest(".upserv-modal").trigger("close",[e(this)])}else e(".upserv-modal .error.invalid-branch").removeClass("hidden");else e(".upserv-modal .error.invalid-url").removeClass("hidden")}),e("#upserv_remove_vcs").on("click",function(t){t.preventDefault();var n=e(".vcs .item.selected").attr("id");n&&c(n)}),e("#upserv_vcs_use_webhooks").on("change",function(t){e(this).prop("checked")?(e(".check-frequency").addClass("hidden"),e(".webhooks").removeClass("hidden")):(e(".webhooks").addClass("hidden"),e(".check-frequency").removeClass("hidden"))}),d()}});