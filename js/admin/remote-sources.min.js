jQuery(document).ready(function(e){if(e("#upserv_vcs").length){var t=e(".form-container.package-source"),n=t.find('input[type="checkbox"], input[type="text"], input[type="number"], input[type="password"], select'),i=t.find('input[type="text"], input[type="number"], input[type="password"]'),s=JSON.parse(e("#upserv_vcs").val()),r=function(){e.each(s,function(t){e("#"+t).length>0||o(t)}),Object.keys(s).length>0&&e(".vcs .item:not(.template)").first().trigger("click")},a=function(i){var s=e("#"+i);0!==s.length&&(e(".vcs .item").removeClass("selected"),s.addClass("selected"),v(!1),t.removeClass("hidden"),l(i),n.trigger("change"))},d=function(t,i){t&&(s[t]={},e.each(n,function(){var n=e(this),i=n.data("prop");i&&(n.is('input[type="checkbox"]')?s[t][i]=0:n.is("select")?s[t][i]=n.find('option[value="daily"]').length>0?"daily":n.find("option").first().val():n.is('input[type="number"]')?s[t][i]=0:s[t][i]="")}),e.each(i,function(e,n){s[t][e]=n}))},o=function(t){var n=e(".vcs .item.template").clone(),i=s[t],r=i.url.match(/https?:\/\/([^\/]+)\//),a=i.url.split("/").filter(function(e){return e.length>0}).pop();n.removeClass("template upserv-modal-open-handle"),n.data("modal_id",null),n.removeAttr("data-modal_id"),n.find(".placeholder").remove(),n.find(".identifier").text(a),n.find(".branch").text(i.branch),n.find(".hidden").removeClass("hidden"),n.attr("id",t),n.find(".service span").addClass("hidden"),r&&"github.com"===r[1]?n.find(".service .github").removeClass("hidden"):r&&"gitlab.com"===r[1]?n.find(".service .gitlab").removeClass("hidden"):r&&"bitbucket.org"===r[1]?n.find(".service .bitbucket").removeClass("hidden"):(s[t].self_hosted=!0,n.find(".service .self-hosted").removeClass("hidden")),n.insertBefore(e(".vcs .item.template"))},c=function(n){delete s[n],e("#"+n).remove(),l(),v(!0),t.addClass("hidden")},l=function(t){n.each(function(){var n=e(this),i=n.data("prop");if(i){var r=t&&s[t]&&void 0!==s[t][i]?s[t][i]:null;n.is('input[type="checkbox"]')?n.prop("checked",["1","true","yes","on",1,!0].includes(r)):n.is('input[type="number"]')?n.val(r?parseInt(r):0):n.val(r||""),e("#upserv_vcs_list").val(t)}})},p=function(t){var n=e(".vcs .item.selected").attr("id"),i=t.data("prop");if(n&&i){var r=null;r=t.is('input[type="checkbox"]')?t.prop("checked")?"1":"0":t.val(),s[n]&&(s[n][i]=r);var a=s[n].url.split("/").filter(function(e){return e.length>0}).pop();e("#"+n).find(".branch").text(s[n].branch),e("#"+n).find(".identifier").text(a),u()}},u=function(){e("#upserv_vcs").val(JSON.stringify(s))},v=function(e){n.prop("disabled",e)};n.on("change",function(t){t.stopPropagation(),p(e(this))}),i.on("keyup",function(t){t.stopPropagation(),p(e(this))}),e(document).on("upserv-modal-close",function(t,n){e(".upserv-wrap").find(".form-container.package-source").length>0&&v(!1)}),e(".vcs").on("click",".item",function(t){var n=e(this);n.hasClass("upserv-modal-open-handle")?(v(!0),e(".upserv-modal .error").addClass("hidden")):a(n.attr("id"))}),e("#upserv_add_vcs").on("click",function(t){t.preventDefault(),e(".upserv-modal .error").addClass("hidden"),e(".vcs .item.selected").removeClass("selected");var n=e("#upserv_add_vcs_url").val(),i=e("#upserv_add_vcs_branch").val();if(n&&n.match(/^https?:\/\/[^\/]+\/[^\/]+\/$/))if(i&&isNaN(i)){var r=Math.random().toString(36).substring(7);d(r,{url:n,branch:i}),o(r,s[r]),a(r),e(this).closest(".upserv-modal").trigger("close",[e(this)])}else e(".upserv-modal .error.invalid-branch").removeClass("hidden");else e(".upserv-modal .error.invalid-url").removeClass("hidden")}),e("#upserv_remove_vcs").on("click",function(t){t.preventDefault();var n=e(".vcs .item.selected").attr("id");n&&c(n)}),e("#upserv_vcs_use_webhooks").on("change",function(t){e(this).prop("checked")?(e(".check-frequency").addClass("hidden"),e(".webhooks").removeClass("hidden")):(e(".webhooks").addClass("hidden"),e(".check-frequency").removeClass("hidden"))}),r()}});