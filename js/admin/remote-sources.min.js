jQuery(document).ready(function(e){if(e("#upserv_vcs").length){var t=e(".form-container.package-source"),n=t.find('input[type="checkbox"][data-prop], input[type="text"][data-prop], input[type="number"][data-prop], input[type="password"][data-prop], input[type="hidden"][data-prop], select[data-prop]'),s=t.find('input[type="text"][data-prop], input[type="number"][data-prop], input[type="password"][data-prop]'),i=e("#upserv_vcs").val()?JSON.parse(e("#upserv_vcs").val()):{};"object"!=typeof i&&(i={});var a=function(){e.each(i,function(t){e("#"+t).length>0||o(t)}),Object.keys(i).length>0&&e(".vcs .item:not(.template)").first().trigger("click")},d=function(s){var i=e("#"+s);0!==i.length&&(e(".vcs .item").removeClass("selected"),i.addClass("selected"),v(!1),t.removeClass("hidden"),p(s),n.trigger("change"))},r=function(t,s){t&&(i[t]={},e.each(n,function(){var n=e(this),s=n.data("prop");n.is('input[type="checkbox"]')?i[t][s]=0:n.is("select")?i[t][s]=n.find('option[value="daily"]').length>0?"daily":n.find("option").first().val():n.is('input[type="number"]')?i[t][s]=0:i[t][s]=""}),e.each(s,function(e,n){i[t][e]=n}))},o=function(t){var n=e(".vcs .item.template").clone(),s=i[t],a=s.url.split("/").filter(function(e){return e.length>0}).pop();n.removeClass("template upserv-modal-open-handle"),n.data("modal_id",null),n.removeAttr("data-modal_id"),n.find(".placeholder").remove(),n.find(".identifier").text(a),n.find(".branch").text(s.branch),n.find(".hidden").removeClass("hidden"),n.attr("id",t),n.find(".service span").addClass("hidden"),n.insertBefore(e(".vcs .item.template")),f(t)},c=function(n){delete i[n],e("#"+n).remove(),p(),v(!0),u(),t.addClass("hidden")},p=function(t){n.each(function(){var n=e(this),s=n.data("prop");if(s){var a=t&&i[t]&&void 0!==i[t][s]?i[t][s]:null;n.is('input[type="checkbox"]')?n.prop("checked",["1","true","yes","on",1,!0].includes(a)):n.is('input[type="number"]')?n.val(a?parseInt(a):0):n.val(a||""),e("#upserv_vcs_list").val(t)}})},l=function(t){var n=e(".vcs .item.selected").attr("id"),s=t.data("prop");if(n&&s){var a=null;a=t.is('input[type="checkbox"]')?t.prop("checked")?"1":"0":t.val(),i[n]&&(i[n][s]=a);var d=i[n].url.split("/").filter(function(e){return e.length>0}).pop();e("#"+n).find(".branch").text(i[n].branch),e("#"+n).find(".identifier").text(d),h(t),f(n),u()}},u=function(){e("#upserv_vcs").val(JSON.stringify(i))},v=function(e){n.prop("disabled",e)},h=function(t){if(0!==t.closest(".self-hosted").length){var n=e(".vcs .item.selected").attr("id"),s=t.prop("checked");e(".self-hosted").prop("checked",!1),t.prop("checked",s),i[n].type=s?t.val():"undefined"}},f=function(n){var s=i[n].url.match(/https?:\/\/([^\/]+)\//),a=e("#"+n);a.find(".service span").addClass("hidden"),t.find(".self-hosted").addClass("hidden"),s&&"github.com"===s[1]?(i[n].type="github",i[n].self_hosted=!1,a.find(".service .github").removeClass("hidden")):s&&"gitlab.com"===s[1]?(i[n].type="gitlab",i[n].self_hosted=!1,a.find(".service .gitlab").removeClass("hidden")):s&&"bitbucket.org"===s[1]?(i[n].type="bitbucket",i[n].self_hosted=!1,a.find(".service .bitbucket").removeClass("hidden")):(i[n].type=i[n].type?i[n].type:"undefined",i[n].self_hosted=!0,a.find(".service .self-hosted-"+i[n].type).removeClass("hidden"),t.find(".self-hosted").removeClass("hidden"))};n.on("change",function(t){t.stopPropagation(),l(e(this))}),s.on("keyup",function(t){t.stopPropagation(),l(e(this))}),e(document).on("upserv-modal-close",function(t,n){e(".upserv-wrap").find(".form-container.package-source").length>0&&v(!1)}),e(".vcs").on("click",".item",function(t){var n=e(this);n.hasClass("upserv-modal-open-handle")?(v(!0),e(".upserv-modal .error").addClass("hidden")):d(n.attr("id"))}),e("#upserv_add_vcs").on("click",function(t){t.preventDefault(),e(".upserv-modal .error").addClass("hidden"),e(".vcs .item.selected").removeClass("selected");var n=e("#upserv_add_vcs_url").val(),s=e("#upserv_add_vcs_branch").val();if(n&&n.match(/^https?:\/\/[^\/]+\/[^\/]+\/$/))if(s&&isNaN(s)){var a=Math.random().toString(36).substring(7);r(a,{url:n,branch:s}),o(a,i[a]),d(a),e(this).closest(".upserv-modal").trigger("close",[e(this)])}else e(".upserv-modal .error.invalid-branch").removeClass("hidden");else e(".upserv-modal .error.invalid-url").removeClass("hidden")}),e("#upserv_remove_vcs").on("click",function(t){t.preventDefault();var n=e(".vcs .item.selected").attr("id");n&&c(n)}),e("#upserv_vcs_use_webhooks").on("change",function(t){e(this).prop("checked")?(e(".check-frequency").addClass("hidden"),e(".webhooks").removeClass("hidden")):(e(".webhooks").addClass("hidden"),e(".check-frequency").removeClass("hidden"))}),a()}});