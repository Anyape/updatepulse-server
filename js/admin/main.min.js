jQuery(document).ready(function(e){function a(e){var a=(new DOMParser).parseFromString(e,"text/html");return a.documentElement.textContent}if(-1!==location.href.indexOf("action=")){var n=window.location.href.split("?");n[1]=n[1].replace("action=","action_done="),history.pushState(null,"",n.join("?"))}e('input[type="password"].secret').on("focus",function(){e(this).attr("type","text")}),e('input[type="password"].secret').on("blur",function(){e(this).attr("type","password")}),e(".upserv-wrap .wp-list-table .delete a").on("click",function(e){var a=window.confirm(UPServAdminMain_l10n.deleteRecord);a||e.preventDefault()}),e(".upserv-delete-all-packages").on("click",function(e){var a=window.confirm(UPServAdminMain_l10n.deletePackagesConfirm);a||e.preventDefault()}),e(".ajax-trigger").on("click",function(n){n.preventDefault();var i=e(this),t=i.data("type"),r={type:t,nonce:e("#upserv_plugin_options_handler_nonce").val(),action:"upserv_"+i.data("action"),data:i.data("selector")?e(i.data("selector")).get().reduce(function(e,a){return e[a.id]="checkbox"===a.type||"radio"===a.type?a.checked:a.value,e},{}):{}};i.attr("disabled","disabled"),e.ajax({url:UPServAdminMain.ajax_url,data:r,type:"POST",success:function(n){if(n.success){if(n.data){t="";e.each(n.data,function(e,n){"btnVal"!==e&&(t+=a(n)+"\n")}),t.length&&window.alert(t)}}else{var t="";e.each(n.data,function(e,n){t+=a(n.message)+"\n"}),window.alert(t)}i.removeAttr("disabled"),n.data&&n.data.btnVal&&i.val(n.data.btnVal)},error:function(e,a){UPServAdminMain.debug&&console.log(a)}})});var i=!1;e("#upserv_register_package_slug").on("input",function(){0<e(this).val().length&&!i?e("#upserv_register_package_trigger").removeAttr("disabled"):i||e("#upserv_register_package_trigger").attr("disabled","disabled")}),e("#upserv_register_package_trigger").on("click",function(a){a.preventDefault();var n=e(this),t={slug:e("#upserv_register_package_slug").val(),nonce:e("#upserv_plugin_options_handler_nonce").val(),action:"upserv_register_package_from_vcs"};n.attr("disabled","disabled"),n.next().css("visibility","visible"),i=!0,e.ajax({url:UPServAdminMain.ajax_url,data:t,type:"POST",success:function(a){if(a.success)window.location.reload(!0);else{var t="";e.each(a.data,function(e,a){t+=a.message+"\n"}),i=!1,n.removeAttr("disabled"),n.next().css("visibility","hidden"),window.alert(t)}},error:function(e,a){UPServAdminMain.debug&&console.log(a),i=!1,n.removeAttr("disabled"),n.next().css("visibility","hidden")}})}),e("#upserv_manual_package_upload").on("change",function(){var a=e(this);0<a.prop("files").length?(e("#upserv_manual_package_upload_filename").val(a.prop("files")[0].name),e("#upserv_manual_package_upload_trigger").removeAttr("disabled")):(e("#upserv_manual_package_upload_filename").val(""),e("#upserv_manual_package_upload_trigger").attr("disabled","disabled"))}),e("#upserv_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(a){var n=e("#upserv_manual_package_upload");n.prop("files",a.originalEvent.dataTransfer.files),n.trigger("change")}),e(".manual-package-upload-trigger").on("click",function(a){a.preventDefault();var n=e(this),i=new FormData,t=!0,r=e("#upserv_manual_package_upload").prop("files")[0],o=/^([a-zA-Z0-9\-\_]*)\.zip$/gm,l=["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"];n.attr("disabled","disabled"),n.next().css("visibility","visible"),void 0!==r&&void 0!==r.type&&void 0!==r.size&&void 0!==r.name?(-1===e.inArray(r.type,l)&&(window.alert(UPServAdminMain_l10n.invalidFileFormat),t=!1),0===r.size&&(window.alert(UPServAdminMain_l10n.invalidFileSize),t=!1),o.test(r.name)||(window.alert(UPServAdminMain_l10n.invalidFileName),t=!1)):(window.alert(UPServAdminMain_l10n.invalidFile),t=!1),t?(i.append("action","upserv_manual_package_upload"),i.append("package",r),i.append("nonce",e("#upserv_plugin_options_handler_nonce").val()),e.ajax({url:UPServAdminMain.ajax_url,data:i,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(a){if(a.success)window.location.reload(!0);else{var i="";e.each(a.data,function(e,a){i+=a.message+"\n"}),n.removeAttr("disabled"),window.alert(i)}},error:function(e,a){UPServAdminMain.debug&&console.log(a)}})):(n.next().css("visibility","hidden"),n.removeAttr("disabled"))})});