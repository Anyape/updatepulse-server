jQuery(document).ready(function(e){function a(e){var a=(new DOMParser).parseFromString(e,"text/html");return a.documentElement.textContent}function n(a){if(e.isPlainObject(a)){if(e("#wppus_license_id").html(a.id),e("#wppus_license_key").val(a.license_key),e("#wppus_license_date_created").val(a.date_created),e("#wppus_license_max_allowed_domains").val(a.max_allowed_domains),e("#wppus_license_owner_name").val(a.owner_name),e("#wppus_license_registered_email").val(a.email),e("#wppus_license_owner_company").val(a.company_name),e("#wppus_license_transaction_id").val(a.txn_id),e("#wppus_license_package_slug").val(a.package_slug),e("#wppus_license_status").val(a.status),e("#wppus_license_package_type").val(a.package_type),"0000-00-00"!==a.date_expiry&&e("#wppus_license_date_expiry").val(a.date_expiry),"0000-00-00"!==a.date_renewed&&e("#wppus_license_date_renewed").val(a.date_renewed),a.allowed_domains.length>0){var n=e(".wppus-domains-list"),i=n.find("li").clone();i.removeClass("wppus-domain-template"),e.each(a.allowed_domains,function(e,a){var p=i.clone();p.find(".wppus-domain-value").html(a),n.append(p)}),e(".wppus-no-domain").hide(),n.show()}}else e("#wppus_license_key").val(e("#wppus_license_key").data("random_key")),e("#wppus_license_date_created").val((new Date).toISOString().slice(0,10)),e("#wppus_license_max_allowed_domains").val(1)}function i(){e("#wppus_license").trigger("reset"),e("wppus_license_values").val(""),e("wppus_license_action").val(""),e(".open-panel").removeAttr("disabled"),e(".wppus-licenses-table .open-panel").show(),e("#wppus_license_id").html(""),e(".wppus-domains-list li:not(.wppus-domain-template)").remove(),e(".wppus-no-domain").show(),e("label.wppus-license-error").hide(),e(".wppus-license-error").removeClass("wppus-license-error")}function p(e,a){e.is(":visible")||e.slideDown(100,function(){a(e),e.find(".inside").animate({opacity:"1"},150)})}function s(e,a){e.is(":visible")&&e.slideUp(100,function(){e.find(".inside").css({opacity:"0"}),a(e)})}if(-1!==location.href.indexOf("action=")){var l=window.location.href.split("?");l[1]=l[1].replace("action=","action_done="),history.pushState(null,"",l.join("?"))}e(".wppus-wrap .wp-list-table .delete a").on("click",function(e){var a=window.confirm(Wppus_l10n.deleteRecord);a||e.preventDefault()}),e(".wppus-delete-all-packages").on("click",function(e){var a=window.confirm(Wppus_l10n.deletePackagesConfirm);a||e.preventDefault()}),e(".wppus-delete-all-licenses").on("click",function(e){var a=window.confirm(Wppus_l10n.deleteLicensesConfirm);a||e.preventDefault()}),e(".ajax-trigger").on("click",function(n){n.preventDefault();var i=e(this),p=i.data("type"),s={type:p,nonce:e("#wppus_plugin_options_handler_nonce").val(),action:"wppus_"+i.data("action"),data:i.data("selector")?e(i.data("selector")).get().reduce(function(e,a){return e[a.id]="checkbox"===a.type||"radio"===a.type?a.checked:a.value,e},{}):{}};i.attr("disabled","disabled"),e.ajax({url:Wppus.ajax_url,data:s,type:"POST",success:function(n){if(n.success){if(n.data){p="";e.each(n.data,function(e,n){"btnVal"!==e&&(p+=a(n)+"\n")}),p.length&&window.alert(p)}}else{var p="";e.each(n.data,function(e,n){p+=a(n.message)+"\n"}),window.alert(p)}i.removeAttr("disabled"),n.data&&n.data.btnVal&&i.val(n.data.btnVal)},error:function(e,a){Wppus.debug&&console.log(a)}})}),e("#wppus_prime_package_slug").on("keyup",function(){var a=e(this);0<a.val().length?e("#wppus_prime_package_trigger").removeAttr("disabled"):e("#wppus_prime_package_trigger").attr("disabled","disabled")}),e("#wppus_prime_package_trigger").on("click",function(a){a.preventDefault();var n=e(this),i={slug:e("#wppus_prime_package_slug").val(),nonce:e("#wppus_plugin_options_handler_nonce").val(),action:"wppus_prime_package_from_remote"};n.attr("disabled","disabled"),n.next().css("visibility","visible"),e.ajax({url:Wppus.ajax_url,data:i,type:"POST",success:function(a){if(a.success)window.location.reload(!0);else{var i="";e.each(a.data,function(e,a){i+=a.message+"\n"}),n.removeAttr("disabled"),n.next().css("visibility","hidden"),window.alert(i)}},error:function(e,a){Wppus.debug&&console.log(a)}})}),e("#wppus_manual_package_upload").on("change",function(){var a=e(this);0<a.prop("files").length?(e("#wppus_manual_package_upload_filename").val(a.prop("files")[0].name),e("#wppus_manual_package_upload_trigger").removeAttr("disabled")):(e("#wppus_manual_package_upload_filename").val(""),e("#wppus_manual_package_upload_trigger").attr("disabled","disabled"))}),e("#wppus_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(a){var n=e("#wppus_manual_package_upload");n.prop("files",a.originalEvent.dataTransfer.files),n.trigger("change")}),e(".manual-package-upload-trigger").on("click",function(a){a.preventDefault();var n=e(this),i=new FormData,p=!0,s=e("#wppus_manual_package_upload").prop("files")[0],l=/^([a-zA-Z0-9\-\_]*)\.zip$/gm,t=["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"];n.attr("disabled","disabled"),n.next().css("visibility","visible"),void 0!==s&&void 0!==s.type&&void 0!==s.size&&void 0!==s.name?(-1===e.inArray(s.type,t)&&(window.alert(Wppus_l10n.invalidFileFormat),p=!1),0===s.size&&(window.alert(Wppus_l10n.invalidFileSize),p=!1),l.test(s.name)||(window.alert(Wppus_l10n.invalidFileName),p=!1)):(window.alert(Wppus_l10n.invalidFile),p=!1),p?(i.append("action","wppus_manual_package_upload"),i.append("package",s),i.append("nonce",e("#wppus_plugin_options_handler_nonce").val()),e.ajax({url:Wppus.ajax_url,data:i,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(a){if(a.success)window.location.reload(!0);else{var i="";e.each(a.data,function(e,a){i+=a.message+"\n"}),n.removeAttr("disabled"),window.alert(i)}},error:function(e,a){Wppus.debug&&console.log(a)}})):(n.next().css("visibility","hidden"),n.removeAttr("disabled"))}),e("#add_license_trigger").on("click",function(){p(e("#wppus_license_panel"),function(){n(),e("#wppus_license_action").val("create"),e(".wppus-edit-license-label").hide(),e(".wppus-license-show-if-edit").hide(),e(".wppus-add-license-label").show(),e(".open-panel").attr("disabled","disabled"),e(".wppus-licenses-table .open-panel").hide(),e("html, body").animate({scrollTop:e("#wppus_license_panel").offset().top-e("#wpadminbar").height()-20},500)})}),e(".wppus-licenses-table .open-panel .edit a").on("click",function(a){a.preventDefault();var i=JSON.parse(e(this).closest("tr").find('input[name="license_data[]"]').val());p(e("#wppus_license_panel"),function(){n(i),e("#wppus_license_action").val("update"),e(".wppus-edit-license-label").show(),e(".wppus-license-show-if-edit").show(),e(".wppus-add-license-label").hide(),e(".open-panel").attr("disabled","disabled"),e(".wppus-licenses-table .open-panel").hide(),e("html, body").animate({scrollTop:e("#wppus_license_panel").offset().top-e("#wpadminbar").height()-20},500)})}),e("#wppus_license_cancel, .close-panel.reset").on("click",function(){e("html, body").animate({scrollTop:e(".wppus-wrap").offset().top-e("#wpadminbar").height()-20},150),s(e("#wppus_license_panel"),function(){i()})}),e.validator&&(e.validator.methods.licenseDate=function(e,a){return this.optional(a)||/[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/.test(e)},e.validator.methods.slug=function(e,a){return this.optional(a)||/[a-z0-9-]*/.test(e)},e("#wppus_license").validate({errorClass:"wppus-license-error",rules:{wppus_license_key:{required:!0},wppus_license_package_slug:{required:!0,slug:!0},wppus_license_registered_email:{required:!0,email:!0},wppus_license_date_created:{required:!0,licenseDate:!0},wppus_license_date_expiry:{licenseDate:!0},wppus_license_date_renewed:{licenseDate:!0},wppus_license_max_allowed_domains:{required:!0}},submitHandler:function(a){var n=e(".wppus-domains-list li:not(.wppus-domain-template) .wppus-domain-value"),i={id:e("#wppus_license_id").html(),license_key:e("#wppus_license_key").val(),max_allowed_domains:e("#wppus_license_max_allowed_domains").val(),allowed_domains:n.map(function(){return e(this).text()}).get(),status:e("#wppus_license_status").val(),owner_name:e("#wppus_license_owner_name").val(),email:e("#wppus_license_registered_email").val(),company_name:e("#wppus_license_owner_company").val(),txn_id:e("#wppus_license_transaction_id").val(),date_created:e("#wppus_license_date_created").val(),date_renewed:e("#wppus_license_date_renewed").val(),date_expiry:e("#wppus_license_date_expiry").val(),package_slug:e("#wppus_license_package_slug").val(),package_type:e("#wppus_license_package_type").val()};e("#wppus_license_values").val(JSON.stringify(i)),e(".no-submit").removeAttr("name"),a.submit()}})),e("#wppus_license_registered_domains").on("click",".wppus-remove-domain",function(a){a.preventDefault(),e(this).parent().remove(),1<=e(".wppus-remove-domain").length&&e(".wppus-no-domain").show()}),e(".wppus-license-date").length>0&&e(".wppus-license-date").datepicker({dateFormat:"yy-mm-dd"})});