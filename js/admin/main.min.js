jQuery(document).ready(function(a){function e(a){var e=(new DOMParser).parseFromString(a,"text/html");return e.documentElement.textContent}if(-1!==location.href.indexOf("action=")){var n=window.location.href.split("?");n[1]=n[1].replace("action=","action_done="),history.pushState(null,"",n.join("?"))}a(".wppus-wrap .wp-list-table .delete a").on("click",function(a){var e=window.confirm(Wppus_l10n.deleteRecord);e||a.preventDefault()}),a(".wppus-delete-all-packages").on("click",function(a){var e=window.confirm(Wppus_l10n.deletePackagesConfirm);e||a.preventDefault()}),a(".ajax-trigger").on("click",function(n){n.preventDefault();var t=a(this),i=t.data("type"),p={type:i,nonce:a("#wppus_plugin_options_handler_nonce").val(),action:"wppus_"+t.data("action"),data:t.data("selector")?a(t.data("selector")).get().reduce(function(a,e){return a[e.id]="checkbox"===e.type||"radio"===e.type?e.checked:e.value,a},{}):{}};t.attr("disabled","disabled"),a.ajax({url:Wppus.ajax_url,data:p,type:"POST",success:function(n){if(n.success){if(n.data){i="";a.each(n.data,function(a,n){"btnVal"!==a&&(i+=e(n)+"\n")}),i.length&&window.alert(i)}}else{var i="";a.each(n.data,function(a,n){i+=e(n.message)+"\n"}),window.alert(i)}t.removeAttr("disabled"),n.data&&n.data.btnVal&&t.val(n.data.btnVal)},error:function(a,e){Wppus.debug&&console.log(e)}})}),a("#wppus_prime_package_slug").on("keyup",function(){var e=a(this);0<e.val().length?a("#wppus_prime_package_trigger").removeAttr("disabled"):a("#wppus_prime_package_trigger").attr("disabled","disabled")}),a("#wppus_prime_package_trigger").on("click",function(e){e.preventDefault();var n=a(this),t={slug:a("#wppus_prime_package_slug").val(),nonce:a("#wppus_plugin_options_handler_nonce").val(),action:"wppus_prime_package_from_remote"};n.attr("disabled","disabled"),n.next().css("visibility","visible"),a.ajax({url:Wppus.ajax_url,data:t,type:"POST",success:function(e){if(e.success)window.location.reload(!0);else{var t="";a.each(e.data,function(a,e){t+=e.message+"\n"}),n.removeAttr("disabled"),n.next().css("visibility","hidden"),window.alert(t)}},error:function(a,e){Wppus.debug&&console.log(e)}})}),a("#wppus_manual_package_upload").on("change",function(){var e=a(this);0<e.prop("files").length?(a("#wppus_manual_package_upload_filename").val(e.prop("files")[0].name),a("#wppus_manual_package_upload_trigger").removeAttr("disabled")):(a("#wppus_manual_package_upload_filename").val(""),a("#wppus_manual_package_upload_trigger").attr("disabled","disabled"))}),a("#wppus_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("drop",function(e){var n=a("#wppus_manual_package_upload");n.prop("files",e.originalEvent.dataTransfer.files),n.trigger("change")}),a(".manual-package-upload-trigger").on("click",function(e){e.preventDefault();var n=a(this),t=new FormData,i=!0,p=a("#wppus_manual_package_upload").prop("files")[0],l=/^([a-zA-Z0-9\-\_]*)\.zip$/gm,o=["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"];n.attr("disabled","disabled"),n.next().css("visibility","visible"),void 0!==p&&void 0!==p.type&&void 0!==p.size&&void 0!==p.name?(-1===a.inArray(p.type,o)&&(window.alert(Wppus_l10n.invalidFileFormat),i=!1),0===p.size&&(window.alert(Wppus_l10n.invalidFileSize),i=!1),l.test(p.name)||(window.alert(Wppus_l10n.invalidFileName),i=!1)):(window.alert(Wppus_l10n.invalidFile),i=!1),i?(t.append("action","wppus_manual_package_upload"),t.append("package",p),t.append("nonce",a("#wppus_plugin_options_handler_nonce").val()),a.ajax({url:Wppus.ajax_url,data:t,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){if(e.success)window.location.reload(!0);else{var t="";a.each(e.data,function(a,e){t+=e.message+"\n"}),n.removeAttr("disabled"),window.alert(t)}},error:function(a,e){Wppus.debug&&console.log(e)}})):(n.next().css("visibility","hidden"),n.removeAttr("disabled"))})});